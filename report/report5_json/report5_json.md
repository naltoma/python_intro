# 課題レポート5: JSONファイルのパース

- ＜目次＞
  - <a href="#abst">課題概要</a>
  - <a href="#howto">取り組み方</a>
  - <a href="#report">レポートに含める内容</a>
  - <a href="#level1">課題詳細</a>
  - <a href="#hints">ヒント</a>
  - <a href="#options">おまけ課題</a>
  - <a href="#upload">提出方法</a>

<hr>

## <a name="abst">課題概要</a>
- JSON形式で記述されたテキストファイルを読み込み、dict型オブジェクトとして読み込もう。
- 達成目標
  - ファイル処理（読み込み）に慣れよう。
  - 正規表現に慣れよう。
  - キャストに慣れよう。
  - dict型オブジェクトの操作に慣れよう。
- 途中までしかやれなかった場合でも、やったのならそこまでの取り組み方や途中経過について報告しよう。提出してもらえれば部分点を出せますが、未提出だと0点です。（遅延提出でも良いですが、遅れすぎると減点も大きいです）

<hr>

## <a name="howto">取り組み方</a>
- ペアや友人らと話し合って取り組んで構わないが、**自分自身の言葉で述べること。試して分かったこと、自身で解決できなかった部分等についてどう取り組んだか、といった過程がわかるように示すこと**。（考えを図表や文章を駆使して表現して報告する練習です）

<hr>

## <a name="report">レポートに含める内容</a>
- レポート作成は当面「googleドキュメント」を使うこと。
- レポートには下記を含めること。
  - **タイトル**
    - 今回は【プログラミング1、レポート課題5: 「JSONファイルのパース」】。
  - **提出日**: yyyy-mm-dd
  - **報告者**: 学籍番号、氏名
    - 複数人で相談しながらやった場合、相談者らを「協力者: 学籍番号、氏名」として示そう。
  - **課題説明**
    - 1,2行程度で課題の内容を説明しよう。
  - **書いたコード（関数のみでOK）**
    - 作成した関数について説明すること。
  - **実行結果**
  - **考察**
    - 課題への取り組みを通し、課題の意義、課題から分かったこと、今後の展望などを述べる。失敗やつまづきがあれば、それらについての失敗分析を含めること。
  - 参考リンク: [実験レポートの書き方](http://www.report.gusoku.net/jikken/jikkenreport.html)
  - その他
    - 通常は感想等をレポートには含めませんが、練習なので課題に取り組みながら何か感じたこと、悩んでいること等、書きたいことがあれば自由に書いてください。（なければ省略OK）

<hr>

## <a name="level">課題詳細</a>
- [JSON](https://www.json.org/json-ja.html)とは、JavaScript Object Notationの略称であり、コンピュータにも人間にも読み書きしやすいテキストファイルの一形式です。厳密な仕様全てに対応するのは厳しいため、今回は「簡単な例だけ」に対応するようなパーサを書いてみよう。
- [パーサ（parser）](https://ja.wikipedia.org/wiki/構文解析器)とは、テキストファイルから情報抽出したりするプログラムの総称である。例えば、メールアドレスから「@以下」を抽出したり、住所情報から「郵便番号」を抽出したり、そもそも郵便番号が正しいか（e.g., 7桁の数字か否か）を判定したり、といった処理を行う。
- 今回は、以下のファイルをパースし、文字列はstr型として、数値はint型として処理し、それらをdict型オブジェクトとして保存しよう。
  - ファイル: [enemy1.json](./enemy1.json)
    - 補足: ここでは、上記ファイルのみを想定したプログラムになっていれば十分である。keyに相当する箇所は、アルファベットのみを想定しよう。valueに相当する箇所は、int型数値のみを想定しよう。
      - 例えば、本来のJSONならば、改行の有無やスペースの有無は無視できる。また、値は文字列や整数以外も記述可能である。が、これらの本来のJSON仕様は、無視して良い。
- 以下に示す仕様を満足しつつ、「実行イメージ」のように結果を出力するプログラムを書け。
- 仕様
  - スクリプトファイル名を ``report5.py`` とする。
  - 少なくとも下記関数を実装すること。他にも追加で関数実装して構わない。
  - 関数名: ``parse_json``
    - 入力（引数）: 1つ。
      - filename: パース対象となるテキストファイル名。（str型）
    - 戻り値: パース結果。（dict型）
      - enemy1.jsonの場合には ``{'slime': {'HP': 5, 'ATK': 2}}`` が戻り値となる。
  - report5.pyに、以下のコードを含めること。

```Python
# report5.py に含めるべきコード

def parse_json(filename):
  # 関数定義

# コマンドラインからのファイル名取得
import sys
if len(sys.argv) == 2:
  filename = sys.argv[1]
  print('filename = {}'.format(filename))
else:
  print('Usage: python {} textfile'.format(sys.argv[0]))
  exit()

# パース結果の出力確認用コード
result = parse_json(filename)
print(type(result))
print(result)
```

- 実行イメージ
```
oct:tnal% python report5.py enemy1.json
<class 'dict'>
{'slime': {'HP': 5, 'ATK': 2}}
```

<hr>

## <a name="hints">ヒント</a>
- 文字列をint型に変換したい。
  - 例えば「``'1'`` はstr型の1」です。これを「int型の1」に変換するには、``int('1')`` のように[int関数](https://docs.python.org/ja/3/library/functions.html?highlight=int#int)を使うことで文字列をint型に変換できます。この処理を ``キャスト（cast）`` と呼びます。
  - 上記とは逆に、int型を文字列に変換したいならば str関数を。文字列をfloat型に変化したい場合にはfloat関数を使いましょう。
- ``  "dragon": {`` という文字列から、dragonという文字列を抽出したい。
  - 考え方
    - (1) 正規表現を作成する。
      - step 1: まず、抽出したい箇所を「どういうパターンになっているか」を考える。
        - ここでは、「スペースが2つ」、「"が1つ」、その後にdragonがあり、「"が1つ」
      - step 2: パターンを[正規表現](https://docs.python.org/ja/3/library/re.html#re.search)で記述する。
        - 「スペースが2つ」は、``  `` と記述できる。もしくは、スペースの数が増減する可能性があることを想定して `` *`` や `` +`` と書くのも良い。*は、その直前に書いた正規表現を0回以上繰り返すことを表したい時に使う特殊文字。+は、その直前に書いた正規表現を1回以上繰り返す場合の特殊文字。
        - 「"が1つ」は、``"`` と記述できる。（そのまま記述できる）
        - 「dragonがあり」は、より詳しく書き下すと「アルファベットからなる文字列」となる。このパターンは ``[A-Za-z]+`` のように記述できる。
          - ``[1-3]`` と ``[123]`` はどちらも同じパターンを表しており、「数値の1〜3のいずれか」の場合に合致している。ASCIIコードで連続している値については ``-`` を使って間を省略して書くことができる。
      - step 3: step 2で考慮したパターンを繋げる。
        - 例えば、`` *"[A-Za-z]+"`` のようになるだろう。
      - step 4: step 3で作成したパターンから、抽出したい箇所を丸括弧で囲う。
        - 今回抽出したい箇所は「dragon」の部分である。その部分を丸括弧で囲うと `` *"([A-Za-z]+)"`` と記述できる。
    - (2) 作成した正規表現を用いて、欲しい箇所を抽出する。
      - step 1: (reモジュール)[https://docs.python.org/ja/3/library/re.html]を読み込む。
      - step 2: パターンに対してre.matchを行う。
        - パターンを用いてマッチング（[re.match](https://docs.python.org/ja/3/library/re.html#re.match)）を行うと、[マッチオブジェクト](https://docs.python.org/ja/3/library/re.html#match-objects)を得られる。
        - このマッチオブジェクトは、もしマッチする箇所がなかった場合には None となる。
      - step 3: マッチオブジェクトに対して必要な処理を書く。
        - step 2で得たオブジェクトに対して、以下のように書くことで丸括弧で指示した箇所を抽出できる。
        - マッチオブジェクトに対する .group() は、マッチした箇所が保存されている。group(0)には全てのマッチ結果が、group(1)には1番目のマッチ結果が、各々保存されている。
  - re.match()以外の代表的な処理。
    - [re.search()](https://docs.python.org/ja/3/library/re.html#re.search): マッチを生じさせる最初の場所を探して、対応する マッチオブジェクトを返す。
    - [re.findall()](https://docs.python.org/ja/3/library/re.html#re.findall): 全ての重複しないマッチを、文字列のリストとして返す。
    - 参考: [チュートリアル](https://docs.python.org/ja/3/howto/regex.html)

```Python
# 抽出例1
import re
target = '  "dragon": {'
pattern = r' *"([A-Za-z]+)"'
result = re.match(pattern, target)
# 上記は2行に分けて書いていますが、まとめて次のように書いてもOK
# result = re.match(r' *"([A-Za-z]+)"', target)
if result:
  print(result.group(1)) #-> dragon

# 抽出例2
target2 = '  "mode": "ATK", "ESC"'
pattern = r' *"([A-Za-z]+)": *"([A-Za-z]+)", *"([A-Za-z]+)"'
result = re.match(pattern, target2)
for value in result.groups():
  print(value)
```

<hr>

## <a name="options">おまけ課題</a>
- おまけ課題
  - 余裕がある人は下記ファイルにも対応できるように拡張してみよう。なお、前述の課題までのものを「report5.py」として残し、提出すること。また、おまけ課題や、独自設定課題などに取り組んだ際には、途中まででも構わないのでレポートに書くことを推奨します。（書いてあれば加点できるので）
- JSONファイル拡張例
  - [enemy2.json](./enemy2.json)
  - [enemy3.json](./enemy3.json)

<hr>

## <a name="upload">提出方法</a>
- 提出物は「レポート」、「スクリプトファイル」の2点である。
  - もしそれ以外に作成したものがあるなら、それも提出しよう。
- レポートは電子ファイルで提出するものとする。
- 提出先＆〆切: 授業ページを参照。
